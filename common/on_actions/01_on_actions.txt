#When adding effects directly in on_actions always consider if it would be best to do so through a scripted effect. on_actions with a lot of script in them are harder to get an overview of.

# country
on_startup = {
	#if = {
	#	limit = {
	#		tag = MLO
	#		NOT = { has_global_flag = game_started }
	#	}
	#	hidden_effect = {
	#		define_consort = {
	#			name = "Bianca"
	#			dynasty = "di Savoia"
	#			birth_date = 1337.1.1
	#			female = yes
	#			adm = 2
	#			dip = 4
	#			mil = 5
	#		}
	#		define_heir = {
	#			name = "Bernabò"
	#			dynasty = "Visconti"
	#			claim = 100
	#			birth_date = 1323.1.1
	#			adm = 2
	#			dip = 1
	#			mil = 4
	#		}
	#	}
	#}
	if = {
		limit = {
			NOT = { has_global_flag = game_started }
		}
		designate_inhospitable_colonies = yes
		yuan_startup_armies = yes
		clr_global_flag = lollardy_started
		every_province = {
			clr_province_flag = just_depopulated
			clr_province_flag = just_exploited
		}
		every_country = {
			limit = {
				ai = yes
				is_at_war = no
			}
			add_country_modifier = {
				name = lower_maintenance
				duration = -1
			}
		}
		every_country = {
			clr_country_flag = just_used_paratroopers
			clr_country_flag = recent_religion_change_bgm
			add_yearly_manpower = 2
		}
		every_province = {
			limit = {
				superregion = china_superregion
				OR = {
					has_terrain = farmlands
					has_terrain = grasslands
				}
			}
			add_permanent_province_modifier = { 
				name = chinese_farmlands
				duration = -1
			}
		}
		every_province = {
			limit = {
				superregion = china_superregion
				NOT = {
					OR = {
						has_terrain = farmlands
						has_terrain = grasslands
					}
				}
			}
			add_permanent_province_modifier = { 
				name = chinese_hinterlands
				duration = -1
			}
		}
	}
	if = {
		limit = {
			NOT = {
				has_global_flag = game_started
			}
		}
		set_global_flag = game_started
		every_province = {
			limit = {
				NOT = {
					OR = {
						continent = north_america
						continent = south_america
						continent = oceania
					}
				}
				OR = {
					AND = {
						OR = {
							culture_group = east_asian
							province_has_center_of_trade_of_level = 3
						}
						development = 15
						OR = {
							has_terrain = farmlands
							has_terrain = grasslands
						}
					}
					AND = {
						province_has_center_of_trade_of_level = 2
						development = 20
					}
				}
			}
			add_institution_embracement = {
				which = urbanization
				value = 100
			}
		}

		#Add language law modifiers preemptively

		#french

		every_province = {
			limit = {
				OR = {
					culture_group = french
					culture_group = franco_provencal
					culture_group = occitan
					culture = basque
					culture = breton
				}
			}
			add_province_triggered_modifier = standardized_language_french
		}

		#german

		every_province = {
			limit = {
				OR = {
					culture_group = benelux
					
					culture_group = germanic
					
				}
			}
			add_province_triggered_modifier = standardized_language_germanic
		}

		#italian

		every_province = {
			limit = {
				OR = {
					culture_group = latin
					culture = nicard
				}
			}
			add_province_triggered_modifier = standardized_language_italian
		}

		#spanish

		every_province = {
			limit = {
				OR = {
					culture_group = iberian
					culture = basque
					culture = catalan
					culture = andalucian
				}
			}
			add_province_triggered_modifier = standardized_language_spanish
		}
		
		1821 = {
			add_permanent_province_modifier = { 
				name = birthplace_of_urbanization
				duration = -1
			}
		}
		236 = {
			add_culture_construction = {
				time = 1.0
				cost = 0.0
			}
		}
		YUA = {
			add_rival = MNG
			country_event = {
				id = BGMTE.3
			}
			add_yearly_manpower = -10
			
		}
		MNG = {
			add_rival = YUA
			country_event = {
				id = BGMTE.3
			}
			add_yearly_manpower = 3.3
			set_mandate = 0
		}
		ENG = {
			add_rival = FRA
			country_event = {
				id = BGMTE.2
			}
			add_truce_with = FRA
		}
		FRA = { add_truce_with = ENG }
		GLH = {
			country_event = {
				id = BGMTE.5
			}
		}
		SER = {
			country_event = {
				id = BGMTE.4
			}
		}
		BOH = {
			country_event = {
				id = BGMTE.6
			}
		}
		CAS = {
			add_rival = TST
			add_rival = ARA
			country_event = {
				id = BGMTE.9
			}
		}
		TST = {
			add_rival = CAS
			country_event = {
				id = BGMTE.9
			}
		}
		NAP = {
			add_rival = HUN
			country_event = {
				id = BGMTE.11
			}
		}
		if = {
			limit = {
				CHG = { ai = yes }
			}
			CHG = {
				capital_scope = {
					build_to_forcelimit = {
						infantry = 0.75
						cavalry = 0.25
						artillery = 0.0
					}
				}
			}
		}
		MOS = {
			add_rival = LIT
		}
		LIT = {
			add_rival = MOS
		}
		TUR = {
			add_rival = BYZ
		}
		BYZ = {
			add_rival = TUR
		}
		HUN = {
			add_rival = NAP
			force_remove_rival = POL
		}
		POL = {
			force_remove_rival = HUN
		}
		ARI = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		MRM = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		OKA = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		RSO = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		SEV = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		SMI = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		PRM = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		FEO = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		ALG = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		TGT = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		TRP = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		GHD = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		FZA = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		FAD = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		HED = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		ANZ = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		GAZ = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		ARL = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		MSY = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		SHM = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		ALH = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		SHM = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		NAJ = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		DAW = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		OMA = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		ORM = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		FRS = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		KHO = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		TRS = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		SHY = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		KHI = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		SIB = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		ARG = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
		}
		MEN = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
			define_ruler = {
				dynasty = "Mentesoglu"
			}
		}
		HMD = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
			define_ruler = {
				dynasty = "Mentesoglu"
			}
		}
		BTL = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
			define_ruler = {
				dynasty = "Rojaki"
			}
		}
		MLK = {
			kill_ruler = yes
			remove_country_modifier = no_stability_start
			define_ruler = {
				dynasty = "Hasan-Jalalyan"
			}
		}
	}
}

on_new_age = {
	if = {
		limit = {
			bgm_france = yes
			NOT = { has_country_flag = had_revolution }
			OR = {
				current_age = age_of_industrialization
				current_age = age_of_great_wars
				current_age = modern_age
			}
		}
		swap_non_generic_missions = yes
	}
}

# country
on_religion_change = {
	
}

# country.
on_secondary_religion_change = {
	
}

# country. Spawned when Enforcing Rebel Demands through a Support Rebels-war.
on_enforce_rebel_demands = {
	# ROOT = The winning country
	# FROM = The loosing country
	set_country_flag = helped_rebels_win_war
}

# country
on_colonial_liberation = {
	if = {
		limit = {
			NOT = { has_country_flag = old_world_to_new_world_flag }
		}
		country_event = { id = colonial_nation.90 days = 1 }
	}
}

# root = winning country, from = loser country
on_main_war_won = {
	if = {
		limit = {
			tag = YUA
			any_subject_country = {
				tag = MNG
				is_subject_of_type = personal_union
			}
		}
		set_emperor_of_china = YUA
		YUA = {
			inherit = MNG
			country_event = {
				id = BGMTE.1
			}
		}
	}

	if = {
		limit = {
			exists = TST
			tag = TST
			any_subject_country = {
				tag = CAS
				is_subject_of_type = personal_union
			}
		}
		TST = {
			inherit = CAS
			set_capital = 219
			change_tag = CAS
			swap_free_idea_group = yes
		}
		CAS = {
			change_country_color = { color = { 184 144 24 } }
		}
	}
}

on_main_war_lost = {
	if = {
		limit = {
			tag = ENG
			NOT = {
				num_of_owned_provinces_with = {
					value = 2
					region = france_region
				}
			}
			NOT = {
				any_subject_country = {
					capital_scope = {
						region = france_region
					}
				}
			}
		}
		set_global_flag = eng_lost_hundred_years_war
		swap_non_generic_missions = yes
	}
}

on_war_ended = { #ROOT - Winer FROM - Loser
	if = {
		limit = {
			NOT = { has_global_flag = trastamara_peace }
			CAS = {
				NOT = { war_with = TST }
				NOT = {
					is_subject_of = TST
				}
			}
		}
		TST = {
			every_owned_province = {
				remove_core = TST
				add_core = CAS
			}
		}
		CAS = {
			inherit = TST
		}
		TST = { every_core_province = { remove_core = TST } }
		set_global_flag = trastamara_peace
	}

	if = {
		limit = {
			NOT = { has_global_flag = red_turban_rebellion_peace }
			exists = MNG
			MNG = {
				NOT = { war_with = YUA }
				NOT = {
					is_subject_of = YUA
				}
			}
		}
		YUA = {
			every_province = {
				limit = {
					OR = {
						is_core = MNG
						superregion = china_superregion
					}
				}
				cede_province = MNG
				add_core = MNG
				remove_core = YUA
			}
		}
		MNG = {
			add_mandate = 50
		}
		set_global_flag = red_turban_rebellion_peace
	}

	if = {
		limit = {
			ai = yes
		}
		add_country_modifier = {
			name = lower_maintenance
			duration = -1
		}
	}

	if = {
		limit = {
			OR = {
				has_reform = celestial_empire
				has_reform = chinese_warlord
			}
		}
		every_owned_province = {
			limit = {
				superregion = china_superregion
			}
			add_core = ROOT
		}
	}


	#Western Schism
	if = {
		limit = { #Avignon Defeat
			202 = {
				owner = {
					NOT = {
						religion = avignon
					}
				}
			}
			has_global_flag = western_schism
			NOT = { has_global_flag = ws_violent_conclusion_avi }
		}
		country_event = {
			id = BGMWS.8
		}
		set_global_flag = ws_violent_conclusion_avi
	}
	if = {
		limit = { #Catholic Defeat
			118 = {
				owner = {
					NOT = {
						religion = catholic
					}
				}
			}
			has_global_flag = western_schism
			NOT = { has_global_flag = ws_violent_conclusion_rome }
		}
		country_event = {
			id = BGMWS.9
		}
		set_global_flag = ws_violent_conclusion_rome
	}
	if = {
		limit = { #Pisan Defeat
			115 = {
				owner = {
					NOT = {
						religion = pisan
					}
				}
			}
			has_global_flag = western_schism
			has_global_flag = pisa_spawned
			NOT = { has_global_flag = ws_violent_conclusion_pisa }
		}
		country_event = {
			id = BGMWS.10
		}
		set_global_flag = ws_violent_conclusion_pisa
	}
}


on_war_won = {
	if = {
		limit = {
			current_age = age_of_feudalism
			NOT = { has_country_flag = making_appanage }
			FROM = { is_subject_of_type = vassal }
		}
		set_country_flag = making_appanage
		create_subject = {
			subject_type = appanage
			who = FROM
		}
		clr_country_flag = making_appanage
	}
	
	if = {
		limit = {
			is_emperor = yes
			FROM = { is_part_of_hre = yes }
		}
		add_imperial_influence = 1
	}
}

on_siege_won_province = {
	if = {
		limit = {
			owner = {
				OR = {
					tag = ANA
					is_subject_of = ANA
				}
			}
		}
		cede_province = controller
		add_core = controller
		change_religion = controller
		change_culture = controller
	}

	if = {
		limit = {
			OR = {
				religion = catholic
				religion = avignon
				religion = pisan
				religion = fraticelli
				religion = orthodox
			}
			controller = {
				has_country_modifier = boh_religious_conviction
			}
		}
		change_religion = hussite
	}
}

# country
# root = winning country, from = loser country
on_battle_won_country = {
	
}

# country
# root = loser country, from = winner country
on_battle_lost_country = {
	
}

# province
# root = location, from = loser country
on_battle_won_province = {
	
}

#Unit Scope OnAction for Battle Won
on_battle_won_unit = {
	if = {
		limit = {
			unit_owner = {
				OR = {
					is_in_war = {
						attacker_leader = THIS
					}
					is_in_war = {
						defender_leader = THIS
					}
				}
			}
			has_ruler_leader_from = FROM
		}
		FROM = {
			random_list = {
				10 = {
					country_event = {
						id = BGMTE.7
					}
				}
				90 = {
	
				}
			}
		}
	}
}

# #Unit Scope OnAction for Battle Lost
on_battle_lost_unit = {

}

# province
# root = location, from = country doing it

# country
on_monarch_death = {

	if = {
		limit = {
			has_country_flag = fiat_currency_mng
		}
		country_event = {
			id = BGM_MNG_missions.2
		}
	}

	if = {
		limit = {
			tag = ENG
			NOT = {
				has_country_flag = edward_dead
			}
		}
		set_country_flag = edward_dead
		define_heir = {
			male = yes
			name = "Richard"
   			monarch_name = "Richard II"
			dynasty = ROOT
			claim = 100
			adm = 2
			dip = 4
			mil = 1
		}
		add_heir_personality = patron_of_arts_personality
	}

	if = {
		limit = {
			tag = PAP
			NOT = {
				has_global_flag = western_schism
			}
			NOT = {
				has_global_flag = hussite_wars_began
			}
		}
		random_list = {
			50 = {
				country_event = {
					id = BGMWS.1
				}
			}
			50 = {

			}
		}
	}

	################
	#FEUDAL BREAKUP#
	################

	if = {
		limit = {
			is_year = 1369
			OR = {
				is_subject_of_type = tributary_state
				is_subject = no
				AND = {
					num_of_cities = 12
					is_emperor = no
				}
			}
			is_subject = no
			NOT = { culture_group = british }
			NOT = { culture_group = east_asian }
			NOT = { culture_group = scandinavian }
			NOT = { culture_group = gaelic }
			NOT = { primary_culture = anglo_norman }
			NOT = { government_rank = 3 }
			NOT = { primary_culture = basque }
			NOT = { has_reform = steppe_horde }
			NOT = { religion = mesoamerican_religion }
			NOT = { is_subject_of_type = personal_union }
			NOT = { has_country_flag = secured_succession_laws }
			OR = {
				NOT = {
					variable_arithmetic_trigger = {
						export_to_variable = { which = diff value = heir_adm }
						export_to_variable = { which = temp value = heir_dip }
						change_variable = { which = diff value = temp }
						export_to_variable = { which = temp value = heir_mil }
						change_variable = { which = diff value = temp }
						export_to_variable = { which = temp value = adm }
						subtract_variable = { which = diff value = temp }
						export_to_variable = { which = temp value = dip }
						subtract_variable = { which = diff value = temp }
						export_to_variable = { which = temp value = mil }
						subtract_variable = { which = diff value = temp }
						check_variable = { which = diff value = 15 }
					}
				}
			}
		}
		inheritance_effect = yes
	}

	if = {
		limit = {
			tag = BOH
			NOT = { has_country_flag = charles_iv_dead }
			NOT = { owns = 201 }
		}
		set_country_flag = charles_iv_dead
		201 = { remove_core = BOH set_in_empire = no }
	}
	if = {
		limit = {
			tag = BOH
			NOT = { has_country_flag = charles_iv_dead }
			NOT = { owns = 4696 }
		}
		set_country_flag = charles_iv_dead
		4696 = { remove_core = BOH set_in_empire = no }
	}
	if = {
		limit = {
			tag = BOH
			NOT = { has_country_flag = charles_iv_dead }
			NOT = { owns = 2991 }
		}
		set_country_flag = charles_iv_dead
		2991 = { remove_core = BOH set_in_empire = no }
	}
	if = {
		limit = {
			tag = BOH
			NOT = { has_country_flag = charles_iv_dead }
			NOT = { owns = 102 }
		}
		set_country_flag = charles_iv_dead
		102 = { remove_core = BOH set_in_empire = no }
	}

	if = {
		limit = {
			tag = FCO
			has_heir_flag = louis_ii_dampierre
		}
		set_ruler_flag = louis_ii_dampierre
	}

	if = {
		limit = {
			tag = FCO
			NEV = {
				has_ruler_flag = louis_ii_dampierre
			}
		}
		NEV = {
			grant_independence = yes
			clr_heir_flag = louis_ii_dampierre
		}
		FCO = {
			clr_heir_flag = louis_ii_dampierre
			create_subject = {
				subject_type = personal_union
				subject = NEV
			}
		}
	}

	if = {
		limit = {
			tag = FCO
			has_ruler_flag = louis_ii_dampierre
		}
		every_country = {
			limit = {
				has_heir_flag = louis_ii_dampierre
			}
			kill_heir = {}
		}
	}

	#Achaea/Naples

	if = {
		limit = {
			tag = ACH
			has_heir_flag = giovanna_i
		}
		set_ruler_flag = giovanna_i
	}

	if = {
		limit = {
			tag = ACH
			NAP = {
				has_ruler_flag = giovanna_i
			}
		}
		NAP = {
			clr_heir_flag = giovanna_i
		}
		NAP = {
			clr_heir_flag = giovanna_i
			create_subject = {
				subject_type = personal_union
				subject = ACH
			}
		}
	}

	if = {
		limit = {
			tag = NAP
			has_ruler_flag = giovanna_i
		}
		every_country = {
			limit = {
				has_heir_flag = giovanna_i
			}
			kill_heir = {}
		}
	}

	if = {
		limit = {
			has_ruler_flag = jeanne_de_reginar
		}
		every_country = {
			limit = {
				has_consort_flag = jeanne_de_reginar
			}
			kill_consort = yes
		}
	}
	######################
	#BGM DYNASTIC ACTIONS#
	######################

	if = {
        limit = {
            has_country_flag = foreign_heir
        }
        clr_country_flag = foreign_heir
		#add_treasury = 1
		random_country = {
			limit = {
				has_ruler_flag = own_ruler_is_heir_@ROOT
            }
            clr_ruler_flag = own_ruler_is_heir_@ROOT
			create_subject = {
                subject_type = personal_union
                subject = ROOT
            }
        }
    }

	if = {
        limit = {
            any_country = { has_ruler_flag = foreign_monarch_is_heir_@ROOT }
        }
        clr_country_flag = foreign_heir
		clr_ruler_flag = foreign_monarch_is_heir_@ROOT
    }

}

on_new_heir = {
	if = {
		limit = {
			OR = {
				has_ruler_flag = is_dumbass
				has_consort_flag = is_dumbass
			}
		}
		random_list = {
			50 = { set_heir_flag = is_dumbass } 
			50 = {  } 
		}
	}
}

on_new_monarch = {
	if = {
		limit = {
			has_ruler_flag = is_dumbass
		}
		country_event = {
			id = BGM_DYNASTIC.20
		}
	}
}

on_royal_marriage = {
	if = {
		limit = {
			ROOT = { has_ruler_flag = is_dumbass }
			FROM = {
				is_origin_of_consort = ROOT
			}
		}
		random_list = {
			50 = { set_consort_flag = is_dumbass } 
			50 = {  } 
		}
	}

	if = {
		limit = {
			FROM = { has_ruler_flag = is_dumbass }
			ROOT = {
				is_origin_of_consort = FROM
			}
		}
		random_list = {
			50 = { set_consort_flag = is_dumbass } 
			50 = {  } 
		}
	}
}

on_heir_death = {

	if = {
		limit = {
			has_heir_flag = louis_ii_dampierre
		}
		clr_heir_flag = louis_ii_dampierre
		every_country = {
			limit = {
				has_heir_flag = louis_ii_dampierre
			}
			kill_heir = {}
			clr_heir_flag = louis_ii_dampierre
		}
	}

	if = {
		limit = {
			has_heir_flag = giovanna_i
		}
		clr_heir_flag = giovanna_i
		every_country = {
			limit = {
				has_heir_flag = giovanna_i
			}
			kill_heir = {}
			clr_heir_flag = giovanna_i
		}
	}
}

on_queen_death = {
	if = {
		limit = {
			has_consort_flag = jeanne_de_reginar
		}
		clr_consort_flag = jeanne_de_reginar
		every_country = {
			limit = {
				has_ruler_flag = jeanne_de_reginar
			}
			kill_ruler = yes
			clr_ruler_flag = jeanne_de_reginar
		}
	}
}

on_adm_tech_taken = { #ROOT - Country, executed after on_tech_taken!
	#change_variable = {
	#	which = RootAdmTech
	#	value = 1
	#}

	if = {
		limit = {
			adm_tech = 8
			OR = {
				NOT = { current_age = age_of_feudalism }
				AND = {
					current_age = age_of_feudalism
					has_age_ability = ab_autocracy
				}
			}
		}
		set_country_flag = secured_succession_laws
	}
}

on_dip_tech_taken = { #ROOT - Country, executed after on_tech_taken!
	#change_variable = {
	#	which = RootDipTech
	#	value = 1
	#}
}

on_mil_tech_taken = { #ROOT - Country, executed after on_tech_taken!
	#change_variable = {
	#	which = RootMilTech
	#	value = 1
	#}
}

on_province_owner_change = {
	if = {
		limit = {
			has_global_flag = western_schism
			owner = { religion = catholic }
			OR = {
				religion = pisan
				religion = avignon
			}
		}
		change_religion = catholic
	}
	if = {
		limit = {
			has_global_flag = western_schism
			owner = { religion = avignon }
			OR = {
				religion = catholic
				religion = pisan
			}
		}
		change_religion = avignon
	}
	if = {
		limit = {
			has_global_flag = western_schism
			owner = { religion = pisan }
			OR = {
				religion = catholic
				religion = avignon
			}
		}
		change_religion = pisan
	}
}

on_religion_change = {
	if = {
		limit = {
			tag = NTI
		}
		change_religion = fraticelli
	}
	if = {
		limit = {
			tag = AVP
		}
		change_religion = avignon
	}
	if = {
		limit = {
			tag = PPP
		}
		change_religion = pisan
	}

	if = {
		limit = {
			has_country_flag = recent_religion_change_bgm
		}
		clr_country_flag = recent_religion_change_bgm #this is to reset the flag
	}
	set_country_flag = recent_religion_change_bgm
}

on_dependency_gained = {
	#if = {
	#	limit = {
	#		current_age = age_of_feudalism
	#	}
	#	FROM = {
	#		country_event = {
	#			id = BGMTE.10
	#			days = 1
	#		}
	#	}
	#}

	if = {
		limit = {
			current_age = age_of_feudalism
			NOT = { has_country_flag = making_appanage }
			is_subject_of_type = vassal
		}
		set_country_flag = making_appanage
		create_subject = {
			subject_type = appanage
			who = FROM
		}
		clr_country_flag = making_appanage
	}
	if = {
		limit = {
			tag = AVP
			NOT = { has_global_flag = western_schism }
		}
		country_event = {
			id = BGMWS.1
		}
	}
}

on_country_creation = {
	if = {
		limit = {
			current_age = age_of_feudalism
			is_subject_of_type = vassal
		}
		country_event = {
			id = BGMTE.10
			#days = 1
		}
	}
}

on_create_vassal = {
	if = {
		limit = {
			current_age = age_of_feudalism
			NOT = { has_country_flag = making_appanage }
			is_subject_of_type = vassal
		}
		set_country_flag = making_appanage
		create_subject = {
			subject_type = appanage
			who = FROM
		}
		clr_country_flag = making_appanage
	}
	if = {
		limit = {
			tag = AVP
		}
		AVP = {
			change_government = theocracy
			add_government_reform = papacy_reform
		}
	}
	if = {
		limit = {
			tag = AVP
			NOT = { has_global_flag = western_schism }
		}
		country_event = {
			id = BGMWS.1
		}
	}

	if = {
		limit = {
			tag = PPP
		}
		PPP = {
			change_government = theocracy
			add_government_reform = papacy_reform
		}
	}
	if = {
		limit = {
			tag = PPP
			NOT = { has_global_flag = western_schism }
		}
		country_event = {
			id = BGMWS.1
		}
	}
}

on_institution_embracement = {
	if = {
		limit = {
			has_institution = nationalism_institution
			NOT = { has_country_flag = embraced_nationalism }
		}
		set_country_flag = embraced_nationalism
		every_owned_province = {
			limit = {
				NOT = {
					culture_group = ROOT
				}
			}
			add_province_modifier = {
				name = nationalism_unrest_bgm
				duration = -1
			}
		}
	}
}

on_province_owner_change = {
	if = {
		limit = {
			NOT = {
				culture_group = owner
			}
			has_institution = nationalism_institution
		}
		add_province_modifier = {
			name = nationalism_unrest_bgm
			duration = -1
		}
	}
}

on_province_culture_converted = {
	if = {
		limit = {
			culture_group = owner
		}
		remove_province_modifier = nationalism_unrest_bgm
	}
}

# province, general conversion through effects
on_province_culture_changed = {
	if = {
		limit = {
			culture_group = owner
		}
		remove_province_modifier = nationalism_unrest_bgm
	}
}

on_overrun = { #ROOT - winner, FROM - loser, on stackwipe
	if = {
		limit = {
			FROM = {
				is_ruler_commanding_unit = yes
			}
		}
		kill_ruler = yes
	}
}

on_government_change = {
	if = {
		limit = {
			OR = {
				has_reform = fascist_mechanic
				has_reform = futurist_mechanic
				bgm_comgovt = yes
			}
		}
		every_country = {
			limit = {
				NOT = {
					government = ROOT
				}
			}
			add_opinion = {
				who = ROOT
				modifier = diff_ideology
			}
		}
		every_country = {
			limit = {
				government = ROOT
			}
			add_opinion = {
				who = ROOT
				modifier = same_ideology
			}
		}
	}
}

on_dip_tech_taken = { #ROOT - Country, executed after on_tech_taken!
	if = {
		limit = {
			dip_tech = 24
		}
		add_country_modifier = {
			name = dip_tech_one
			duration = -1
		}
	}
	if = {
		limit = {
			dip_tech = 28
		}
		add_country_modifier = {
			name = dip_tech_two
			duration = -1
		}
	}
	if = {
		limit = {
			dip_tech = 32
		}
		add_country_modifier = {
			name = dip_tech_three
			duration = -1
		}
	}
	if = {
		limit = {
			OR = {
				dip_tech = 43
				dip_tech = 45
				dip_tech = 47
				dip_tech = 49
				dip_tech = 51
				dip_tech = 53
			}
		}
		country_event = {
			id = BGM_GOV.6
		}
	}
}

on_mil_tech_taken = { #ROOT - Country, executed after on_tech_taken!
	if = {
		limit = {
			mil_tech = 38
			NOT = { mil_tech = 48 }
		}
		country_event = {
			id = artillery_modernization.1
		}
	}
}

on_force_conversion = {
	add_unrest = 10
}